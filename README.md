# FastNeuralStyleTransform

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç–∏–ª—è (Fast Neural Style Transfer) –Ω–∞ –æ—Å–Ω–æ–≤–µ feed-forward —Å–µ—Ç–∏ + –ø–µ—Ä—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã—Ö –ª–æ—Å—Å–æ–≤ VGG16.  
–ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

- —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—é –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–ª–∏ —Ü–µ–ª—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π;
- –æ–±—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π —Å—Ç–∏–ª—è –∏–∑ –æ–¥–Ω–æ–≥–æ —Å—Ç–∏–ª—å-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è;
- —Ä–∞–±–æ—Ç—É –Ω–∞ GPU –∏–ª–∏ CPU.

–ú–æ–¥–µ–ª–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –±—ã–ª–∏ –æ–±—É—á–µ–Ω—ã –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ –∏–∑ 16.000 –∫–∞—Ä—Ç–∏–Ω–æ–∫.

---

# üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```

FastNeuralStyleTransform/
‚îú‚îÄ‚îÄ main.py                     # –∏–Ω—Ñ–µ—Ä–µ–Ω—Å (—Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è)
‚îú‚îÄ‚îÄ train.py                    # –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Å—Ç–∏–ª—è
‚îú‚îÄ‚îÄ style_transfer/
‚îÇ   ‚îú‚îÄ‚îÄ model.py                # –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ StyleTransferNet
‚îÇ   ‚îú‚îÄ‚îÄ losses.py               # Gram + –∫–æ–Ω—Ç–µ–Ω—Ç + —Å—Ç–∏–ª—å + TV
‚îÇ   ‚îú‚îÄ‚îÄ vgg.py                  # VGG16 –¥–ª—è –ø–µ—Ä—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã—Ö –ª–æ—Å—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ image_io.py             # –∑–∞–≥—Ä—É–∑–∫–∞, –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ **init**.py
‚îú‚îÄ‚îÄ images/                     # –≤—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø—Ä–∏–º–µ—Ä)
‚îú‚îÄ‚îÄ styles/                     # –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∏–ª—è
‚îú‚îÄ‚îÄ checkpoints*/               # –ø–∞–ø–∫–∏ —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏
‚îî‚îÄ‚îÄ output/                     # —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏

````

---

# üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone https://github.com/KoFey/FastNeuralStyleTransform.git
cd FastNeuralStyleTransform

python -m venv venv
# Windows:
venv\Scripts\activate
# Linux/macOS:
source venv/bin/activate

pip install -r requirements.txt
````

---

# üñº –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–∏–Ω—Ñ–µ—Ä–µ–Ω—Å)

–°–∫—Ä–∏–ø—Ç: **`main.py`** 

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:

```bash
python main.py -h
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä             | –û–ø–∏—Å–∞–Ω–∏–µ                                                                    |
| -------------------- | --------------------------------------------------------------------------- |
| `--style-checkpoint` | –ü—É—Ç—å –∫ `.pth` —Ñ–∞–π–ª—É –≤–µ—Å–æ–≤ —Å—Ç–∏–ª–µ–≤–æ–π –º–æ–¥–µ–ª–∏ (**–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π**)                |
| `--content`          | –ü—É—Ç—å –∫ –æ–¥–Ω–æ–º—É –≤—Ö–æ–¥–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é                                          |
| `--content-dir`      | –ü–∞–ø–∫–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤—Å–µ —Ñ–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ jpg/png/...) |
| `--output-dir`       | –ü–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `./output`)                   |
| `--max-size`         | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø–æ –±–æ–ª—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ), default=1024     |
| `--device`           | `auto` / `cpu` / `cuda`                                                     |

–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å `--content` –∏–ª–∏ `--content-dir`, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π.

---

## ‚úî –ü—Ä–∏–º–µ—Ä: —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```bash
python main.py \
  --style-checkpoint checkpoints-udnie/udnie.pth \
  --content images/my_photo.jpg \
  --output-dir output \
  --device auto
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –∫–∞–∫:

```
output/my_photo.jpg
```

---

## ‚úî –ü—Ä–∏–º–µ—Ä: —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Ü–µ–ª–æ–π –ø–∞–ø–∫–∏

```bash
python main.py \
  --style-checkpoint checkpoints-mosaic/mosaic.pth \
  --content-dir images/ \
  --output-dir output-mosaic \
  --max-size 1024 \
  --device cuda
```

–í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ `images/` –±—É–¥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ `output-mosaic/`.

---

# üß† –û–±—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏ —Å—Ç–∏–ª—è

–°–∫—Ä–∏–ø—Ç: **`train.py`** 

### –ê—Ä–≥—É–º–µ–Ω—Ç—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä           | –û–ø–∏—Å–∞–Ω–∏–µ                                                             |
| ------------------ | -------------------------------------------------------------------- |
| `--dataset`        | –ü—É—Ç—å –∫ –¥–∞—Ç–∞—Å–µ—Ç—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ *.jpg/png/...*) |
| `--style-image`    | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∏–ª—è                                                    |
| `--image-size`     | –†–∞–∑–º–µ—Ä –≤—Ö–æ–¥–∞ –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ (default=256)                              |
| `--batch-size`     | –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ (default=4)                                             |
| `--epochs`         | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö (default=2)                                          |
| `--lr`             | Learning rate (default=1e-3)                                         |
| `--checkpoint-dir` | –ü–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π                                         |
| `--device`         | auto / cpu / cuda                                                    |

### ‚úî –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ –æ–±—É—á–µ–Ω–∏—è

```bash
python train.py \
  --dataset /datasets/coco/train2014 \
  --style-image styles/mosaic.jpg \
  --checkpoint-dir checkpoints-mosaic \
  --epochs 2 \
  --batch-size 4 \
  --image-size 256 \
  --lr 1e-3 \
  --device cuda
```

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —ç–ø–æ—Ö–∏ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª:

```
checkpoints-mosaic/style_epoch_1.pth
checkpoints-mosaic/style_epoch_2.pth
```

---

# ‚öô –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ –æ–±—É—á–µ–Ω–∏—è

## üé® 1. –î–∞–Ω–Ω—ã–µ

–î–∞—Ç–∞—Å–µ—Ç —Å—Ç—Ä–æ–∏—Ç—Å—è –∏–∑ –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ `--dataset`
(`FlatImageDataset`) 

–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç:

* Resize(image_size)
* CenterCrop(image_size)
* ToTensor ‚Üí [0‚Äì1]
* √ó 255 (–º–æ–¥–µ–ª—å –æ–∂–∏–¥–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω [0‚Äì255]) ‚Äî —Å–º. `to_255()`.

## üß© 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ StyleTransferNet

–ü–æ–ª–Ω—ã–π –∫–æ–¥ –≤ `model.py` 

* Downsampling: Conv ‚Üí Conv ‚Üí Conv
* 5 Residual Blocks
* UpsampleConvBlock √ó 2
* Conv(9√ó9) –Ω–∞ –≤—ã—Ö–æ–¥–µ
* InstanceNorm2d –≤–µ–∑–¥–µ
* Reflection padding (—É–º–µ–Ω—å—à–∞–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã)

–í—ã—Ö–æ–¥ —Ä–µ–∑–∞–Ω –Ω–∞ –¥–∏–∞–ø–∞–∑–æ–Ω `[0,255]`.

## üßÆ 3. –õ–æ—Å—Å—ã

–í–Ω—É—Ç—Ä–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥—É–ª—å `StyleContentLoss` :

* **Content loss** ‚Äî MSE –º–µ–∂–¥—É feature maps —É—Ä–æ–≤–Ω—è relu3_3
* **Style loss** ‚Äî —Å—É–º–º–∞ MSE –º–µ–∂–¥—É Gram-–º–∞—Ç—Ä–∏—Ü–∞–º–∏ –Ω–∞ 4 —É—Ä–æ–≤–Ω—è—Ö VGG
* **TV loss** ‚Äî —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ (Total Variation)

VGG16 –±–µ—Ä—ë—Ç—Å—è –∫–∞–∫ feature extractor (`VGGFeatures`) .

–°—Ç–∏–ª—å–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Å–ø–∏—Å–æ–∫ **Gram-–º–∞—Ç—Ä–∏—Ü** –∑–∞—Ä–∞–Ω–µ–µ:

```python
prepare_style_grams(style_path, device, vgg, image_size)
```

## üìà 4. Optimizer

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Adam` (lr = `--lr`).

---

# üì¶ –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—É—á–µ–Ω–∏—è

–ö–∞–∂–¥–∞—è —ç–ø–æ—Ö–∞ —Å–æ–∑–¥–∞—ë—Ç `.pth` —Ñ–∞–π–ª, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π `state_dict` –º–æ–¥–µ–ª–∏:

```python
torch.save(model.state_dict(), checkpoint_path)
```

–ï–≥–æ –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```bash
python main.py \
  --style-checkpoint checkpoints-your-style/style_epoch_2.pth \
  --content images/photo.jpg \
  --output-dir output \
  --device auto
```

---
